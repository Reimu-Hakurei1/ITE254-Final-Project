<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ITE254-Final-Project - Music</title>
  <link rel="icon" href="icon.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./styles (web).css">
  <style>
    body { background: linear-gradient(180deg,#0f0f0f,#121212 70%); color:#eaeaea; padding-bottom:120px; }
    #userEmail { font-weight: 500; }
    .page-header { text-align:center; padding:2rem 1rem; color:white; }
    .album-container { display:flex; justify-content:center; margin:2rem 0; }
    .album-container img { width:340px; height:340px; border-radius:12px; object-fit:cover; box-shadow:0 12px 28px rgba(0,0,0,0.7); }
    .music-section { width:100%; max-width:1200px; margin:0 auto; padding:0 2rem; }
    .track { display:flex; align-items:center; gap:12px; padding:10px 14px; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer; transition:background .15s; }
    .track:hover { background:rgba(255,255,255,0.05); }
    .track.active { background:rgba(29,185,84,0.15); }
    .track img { width:56px; height:56px; border-radius:6px; object-fit:cover; }
    .track-info { flex:1; min-width:0; }
    .track-title { font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .track-artist { font-size:0.9rem; color:#bdbdbd; }
    /* Player bar */
    .player-bar { position:fixed; left:0; right:0; bottom:0; background:#181818; border-top:1px solid rgba(255,255,255,0.05); color:#fff; padding:10px 18px; display:flex; align-items:center; gap:12px; z-index:2000; }
    .player-left { display:flex; align-items:center; gap:12px; width:250px; }
    .player-left img { width:56px; height:56px; border-radius:6px; object-fit:cover; }
    .player-center { flex:1; display:flex; flex-direction:column; align-items:center; gap:6px; }
    .controls { display:flex; gap:10px; align-items:center; }
    .controls button { background:transparent; border:none; color:#fff; font-size:1.2rem; }
    .controls button.play { background:#1DB954; color:#000; font-weight:bold; border-radius:50%; width:42px; height:42px; display:flex; align-items:center; justify-content:center; font-size:1.3rem; }
    .progress-wrap { display:flex; align-items:center; gap:8px; width:100%; }
    .time { font-size:0.8rem; color:#bdbdbd; width:40px; text-align:center; }
    .progress { flex:1; height:6px; background:#333; border-radius:999px; position:relative; cursor:pointer; }
    .progress .bar { height:100%; background:#1DB954; width:0%; border-radius:999px; }
    .progress .thumb { width:14px; height:14px; border-radius:50%; background:#fff; position:absolute; top:50%; transform:translate(-50%,-50%); left:0%; display:none; }
    .progress:hover .thumb { display:block; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDXWF4fNvq4aS4RWBkqEuykt4zzFdt6cqU",
      authDomain: "ite254-final-project.firebaseapp.com",
      projectId: "ite254-final-project",
      storageBucket: "ite254-final-project.appspot.com",
      messagingSenderId: "853636478780",
      appId: "1:853636478780:web:bd1af21cb7474926db9039",
      measurementId: "G-ELH7M25FKW"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
  </script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="./index.html">ITE254-Final-Project</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="./index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="./levelselector.html">Play Game</a></li>
          <li class="nav-item"><a class="nav-link active" href="./music.html">Music</a></li>
          <li class="nav-item"><a class="nav-link" href="./about.html">About</a></li>
          <li class="nav-item"><a class="nav-link" href="./contact.html">Contact</a></li>
        </ul>
        <span id="userEmail" class="navbar-text text-white me-2 d-none"></span>
        <button id="signOutBtn" class="btn btn-outline-light d-none">Sign Out</button>
      </div>
    </div>
  </nav>


  <!-- Big album -->
  <div class="album-container">
    <img id="albumCover" src="covers/fastrun.jpg" alt="Album cover">
  </div>

  <!-- Music list -->
  <div class="music-section">
    <h2>Music</h2>
    <div id="trackList"></div>
  </div>

  <!-- Player bar -->
  <div class="player-bar">
    <div class="player-left">
      <img id="miniCover" src="covers/fastrun.jpg" alt="cover">
      <div>
        <div id="songTitle" style="font-weight:600">Fast Run</div>
        <div id="songArtist" style="font-size:0.9rem; color:#bdbdbd">Composer A</div>
      </div>
    </div>
    <div class="player-center">
      <div class="controls">
        <button id="prev">⏮</button>
        <button id="play" class="play">▶</button>
        <button id="next">⏭</button>
      </div>
      <div class="progress-wrap">
        <div class="time" id="curTime">0:00</div>
        <div class="progress" id="progress">
          <div class="bar" id="progressBar"></div>
          <div class="thumb" id="thumb"></div>
        </div>
        <div class="time" id="durTime">0:00</div>
      </div>
    </div>
  </div>

  <audio id="audioEl" preload="metadata"></audio>

  <!-- Footer -->
  <footer class="text-center p-3 bg-dark text-white">
    <p>© ITE254 Final Project</p>
    <div>
      <a href="https://www.facebook.com/" class="btn btn-outline-light btn-sm">Share on Facebook</a>
      <a href="https://www.twitter.com/" class="btn btn-outline-light btn-sm">Share on Twitter</a>
    </div>
  </footer>

  <!-- Script -->
  <script>
    const tracks = [
      {title:"Super Mario World - Wandering the Plains", artist:"Koji Kondo", file:"songs/savegameroom.mp3", cover:"covers/mario world.jpg"},
      {title:"Touhou Spell Bubble - Character Select", artist:"Masaki (ZUNTATA)", file:"songs/levelselector.mp3", cover:"covers/Touhou spell bubble.png"},
      {title:"Super Mario Yoshi Island - Ending", artist:"Koji Kondo", file:"songs/Intro 1.ogg", cover:"covers/Yoshi Island.png"},
      {title:"Super Mario Yoshi Island - Big Boss BGM", artist:"Koji Kondo", file:"songs/Intro 2.mp3", cover:"covers/Yoshi Island.png"},
      {title:"Super Mario World - Overworld", artist:"Koji Kondo", file:"songs/Mario World - Overworld.mp3", cover:"covers/mario world.jpg"},
      {title:"Super Mario World - Underground", artist:"Koji Kondo", file:"songs/Mario World - Underground.mp3", cover:"covers/mario world.jpg"},
      {title:"Super Mario World - Athletic", artist:"Koji Kondo", file:"songs/Mario World - Athletic.mp3", cover:"covers/mario world.jpg"},
      {title:"Super Mario Yoshi Island - Castle & Fortress", artist:"Koji Kondo", file:"songs/Yoshi Island - Castle.mp3", cover:"covers/Yoshi Island.png"},
      {title:"Super Mario All-Stars - Swimming(Hurry Up)", artist:"Koji Kondo", file:"songs/Super Mario Bros All-Star- Underwater Sped up.mp3", cover:"covers/mario all-star.png"},
      {title:"Super Mario World - Haunted House", artist:"Koji Kondo", file:"songs/Haunted House.mp3", cover:"covers/mario world.jpg"},
      {title:"Super Mario Yoshi Island - Underground BGM", artist:"Koji Kondo", file:"songs/Yoshi Island - Underground.mp3", cover:"covers/Yoshi Island.png"},
      {title:"Super Mario All-Stars - Underground", artist:"Koji Kondo", file:"songs/Super Mario Bros All-Star - Underground.mp3", cover:"covers/mario all-star.png"},
      {title:"Super Mario Yoshi Island - Aboveground", artist:"Koji Kondo", file:"songs/Yoshi Island - Aboveground.mp3", cover:"covers/Yoshi Island.png"},
      {title:"Super Mario World - Athletic(Yoshi)", artist:"Koji Kondo", file:"songs/Mario World - Athletic (Yoshi).mp3", cover:"covers/mario world.jpg"},
      {title:"Rigit Obstacles", artist:"Virgill", file:"songs/Rigit Obstacles.mp3", cover:"covers/00000401.png"},
      {title:"Sirens", artist:"Dave the Brave", file:"songs/Fastrun 2.ogg", cover:"covers/mf.jpg"},
      {title:"Jaguar XJ220 - Speed-E-Boy", artist:"Martin Iveson", file:"songs/Yky.mp3", cover:"covers/jaguar_xj220_01.png"},
      {title:"Super Mario Yoshi Island - Flower Garden", artist:"Koji Kondo", file:"songs/Yoshi Island - Flower Garden.mp3", cover:"covers/Yoshi Island.png"},
      {title:"Apoplexy", artist:"Bee Hunter", file:"songs/Apoplexytanks.ogg", cover:"covers/600x600bf-60.jpg"},
      {title:"Super Mario Yoshi Island - Bowser", artist:"Koji Kondo", file:"songs/Yoshi Island - Final Boss.ogg", cover:"covers/Yoshi Island.png"},
      {title:"Super Mario World - Staff Roll", artist:"Koji Kondo", file:"songs/Mario World - Ending.mp3", cover:"covers/mario world.jpg"},
    ];

    let currentIndex = 0, isPlaying = false;
    const audio = document.getElementById('audioEl');
    const albumCover = document.getElementById('albumCover');
    const miniCover = document.getElementById('miniCover');
    const songTitle = document.getElementById('songTitle');
    const songArtist = document.getElementById('songArtist');
    const playBtn = document.getElementById('play');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const progress = document.getElementById('progress');
    const progressBar = document.getElementById('progressBar');
    const thumb = document.getElementById('thumb');
    const curTime = document.getElementById('curTime');
    const durTime = document.getElementById('durTime');
    const trackList = document.getElementById('trackList');

    function loadTrack(i) {
      const t = tracks[i];
      currentIndex = i;
      audio.src = t.file;
      songTitle.textContent = t.title;
      songArtist.textContent = t.artist;
      albumCover.src = t.cover;
      miniCover.src = t.cover;
      document.querySelectorAll('.track').forEach(el=>el.classList.remove('active'));
      const active = document.querySelector(`.track[data-index="${i}"]`);
      if (active) active.classList.add('active');
    }
    function playTrack() { audio.play(); isPlaying=true; playBtn.textContent='❚❚'; }
    function pauseTrack() { audio.pause(); isPlaying=false; playBtn.textContent='▶'; }
    playBtn.addEventListener('click',()=>{isPlaying?pauseTrack():playTrack();});
    prevBtn.addEventListener('click',()=>{loadTrack((currentIndex-1+tracks.length)%tracks.length);playTrack();});
    nextBtn.addEventListener('click',()=>{loadTrack((currentIndex+1)%tracks.length);playTrack();});
    audio.addEventListener('timeupdate',()=>{
      if(audio.duration){
        const pct=(audio.currentTime/audio.duration)*100;
        progressBar.style.width=pct+"%"; thumb.style.left=pct+"%";
        curTime.textContent=formatTime(audio.currentTime);
        durTime.textContent=formatTime(audio.duration);
      }
    });
    progress.addEventListener('click',(e)=>{
      const rect=progress.getBoundingClientRect();
      const pct=(e.clientX-rect.left)/rect.width;
      audio.currentTime=pct*audio.duration;
    });
    function formatTime(sec){const m=Math.floor(sec/60);const s=Math.floor(sec%60).toString().padStart(2,"0");return `${m}:${s}`;}
    audio.addEventListener('ended',()=>{nextBtn.click();});
    tracks.forEach((t,i)=>{
      const div=document.createElement('div');
      div.className='track';
      div.dataset.index=i;
      div.innerHTML=`<img src="${t.cover}" alt="${t.title}"><div class="track-info"><div class="track-title">${t.title}</div><div class="track-artist">${t.artist}</div></div>`;
      div.addEventListener('click',()=>{loadTrack(i);playTrack();});
      trackList.appendChild(div);
    });
    loadTrack(currentIndex);

    // Firebase auth
    (function() {
      const signOutBtn = document.getElementById('signOutBtn');
      const userEmailSpan = document.getElementById('userEmail');
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          userEmailSpan.textContent = user.email || user.displayName || '';
          userEmailSpan.classList.remove('d-none');
          signOutBtn.classList.remove('d-none');
        } else {
          window.location.href = "Login.html";
        }
      });
      signOutBtn.addEventListener('click', function() {
        firebase.auth().signOut().then(() => {
          window.location.href = "Login.html";
        }).catch((err) => { alert("Sign out error: " + err.message); });
      });
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
