<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mario Music Player</title>
  <link rel="icon" href="icon.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./styles (web).css">
  <style>
    #userEmail { font-weight: 500; }
    body {
      background-color: #121212;
      color: #fff;
    }
    .playlist-container {
      max-width: 700px;
      margin: 2rem auto;
    }
    .playlist-item {
      padding: 15px;
      border-bottom: 1px solid #333;
      cursor: pointer;
    }
    .playlist-item:hover {
      background-color: #1db95433;
    }
    .playlist-item.active {
      background-color: #1db95455;
      font-weight: bold;
    }
    /* Bottom Player Bar */
    .player-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #181818;
      border-top: 1px solid #333;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 1000;
    }
    .player-info {
      flex: 1;
      padding-left: 10px;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .progress {
      flex: 2;
      height: 6px;
      margin: 0 15px;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-auth-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDXWF4fNvq4aS4RWBkqEuykt4zzFdt6cqU",
      authDomain: "ite254-final-project.firebaseapp.com",
      projectId: "ite254-final-project",
      storageBucket: "ite254-final-project.appspot.com",
      messagingSenderId: "853636478780",
      appId: "1:853636478780:web:bd1af21cb7474926db9039",
      measurementId: "G-ELH7M25FKW"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
  </script>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="./index.html">ITE254-Final-Project</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
              aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="./index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="./levelselector.html">Play Game</a></li>
          <li class="nav-item"><a class="nav-link active" href="./music.html">Music</a></li>
          <li class="nav-item"><a class="nav-link" href="./about.html">About</a></li>
          <li class="nav-item"><a class="nav-link" href="./contact.html">Contact</a></li>
        </ul>
        <span id="userEmail" class="navbar-text text-white me-2 d-none"></span>
        <button id="signOutBtn" class="btn btn-outline-light d-none">Sign Out</button>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="text-center p-5 text-white" style="background: linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.3));">
    <h1>Music Use In Game</h1>
  </header>

  <!-- Playlist -->
  <main class="playlist-container">
    <div class="playlist-item" data-src="songs/fastrun.mp3">Apoplexytanks</div>
    <div class="playlist-item" data-src="songs/yky.mp3">Fastrun 1</div>
    <div class="playlist-item" data-src="songs/overworld.mp3">Fastrun 2</div>
    <div class="playlist-item" data-src="songs/Intro 2.mp3">Yoshi Island - Ending</div>
	<div class="playlist-item" data-src="songs/Intro 2.mp3">Yoshi Island - Big Boss</div>
    <div class="playlist-item" data-src="songs/Mario RPG - Bowser Battle</.mp3">Mario RPG - Bowser Battle</div>
	<div class="playlist-item" data-src="songs/Mario World - Athletic (Yoshi).mp3">Mario World - Athletic (Yoshi)</div>
	<div class="playlist-item" data-src="songs/Mario World - Athletic.mp3">Mario World - Athletic</div>
	<div class="playlist-item" data-src="songs/Mario World - Ending.mp3">Mario World - Ending</div>
	<div class="playlist-item" data-src="songs/Mario World - Overworld.mp3">Mario World - Overworld</div>
	<div class="playlist-item" data-src="songs/Mario World - Underground.mp3">Mario World - Underground</div>
	<div class="playlist-item" data-src="songs/Super Mario Bros All-Star - Underground.mp3">Super Mario Bros All-Star - Underground</div>
	<div class="playlist-item" data-src="songs/Super Mario Bros All-Star- Underwater Sped up.mp3">Super Mario Bros All-Star- Underwater Sped up</div>
	<div class="playlist-item" data-src="songs/Yky.mp3">Yky</div>
	<div class="playlist-item" data-src="songs/Yoshi Island - Aboveground.mp3">Yoshi Island - Aboveground</div>
	<div class="playlist-item" data-src="songs/Yoshi Island - Athletic.mp3">Yoshi Island - Athletic</div>
	<div class="playlist-item" data-src="songs/Yoshi Island - Castle.mp3">Yoshi Island - Castle</div>
	<div class="playlist-item" data-src="songs/Yoshi Island - Underground.mp3">Yoshi Island - Underground</div>
	<div class="playlist-item" data-src="songs/Yoshi Island - levelselector.mp3">Touhou Spell Bubble - Characters Select</div>
	<div class="playlist-item" data-src="songs/Yoshi Island - savegameroom.mp3">Mario World - Overworld Map Theme</div>
    <!-- add as many as you want -->
  </main>

  <!-- Player Bar -->
  <div class="player-bar d-none">
    <div class="player-info">
      <strong id="currentSong">No song selected</strong>
      <div id="timeDisplay">0:00 / 0:00</div>
    </div>

    <button id="prevBtn" class="btn btn-sm btn-light">⏮</button>
    <button id="playBtn" class="btn btn-sm btn-success">▶</button>
    <button id="pauseBtn" class="btn btn-sm btn-danger">⏸</button>
    <button id="nextBtn" class="btn btn-sm btn-light">⏭</button>

    <div class="progress">
      <div id="progressBar" class="progress-bar bg-success" style="width: 0%"></div>
    </div>
    <audio id="audio"></audio>
  </div>

  <!-- Footer -->
  <footer class="text-center p-3 bg-dark text-white">
    <p>© ITE254 Final Project</p>
  </footer>

  <!-- Script -->
  <script>
    const audio = document.getElementById("audio");
    const playerBar = document.querySelector(".player-bar");
    const playlistItems = document.querySelectorAll(".playlist-item");
    const currentSongTitle = document.getElementById("currentSong");
    const progressBar = document.getElementById("progressBar");
    const timeDisplay = document.getElementById("timeDisplay");
    const playBtn = document.getElementById("playBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    let currentIndex = -1;

    function loadSong(index) {
      playlistItems.forEach(item => item.classList.remove("active"));
      playlistItems[index].classList.add("active");
      audio.src = playlistItems[index].dataset.src;
      currentSongTitle.textContent = playlistItems[index].textContent;
      audio.load();
      currentIndex = index;
    }

    function playSong() {
      audio.play();
      playerBar.classList.remove("d-none");
    }

    function pauseSong() {
      audio.pause();
    }

    playlistItems.forEach((item, index) => {
      item.addEventListener("click", () => {
        loadSong(index);
        playSong();
      });
    });

    playBtn.addEventListener("click", playSong);
    pauseBtn.addEventListener("click", pauseSong);

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        loadSong(currentIndex - 1);
        playSong();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex < playlistItems.length - 1) {
        loadSong(currentIndex + 1);
        playSong();
      }
    });

    audio.addEventListener("timeupdate", () => {
      if (audio.duration) {
        const percent = (audio.currentTime / audio.duration) * 100;
        progressBar.style.width = percent + "%";

        const curMin = Math.floor(audio.currentTime / 60);
        const curSec = Math.floor(audio.currentTime % 60).toString().padStart(2,"0");
        const durMin = Math.floor(audio.duration / 60);
        const durSec = Math.floor(audio.duration % 60).toString().padStart(2,"0");

        timeDisplay.textContent = `${curMin}:${curSec} / ${durMin}:${durSec}`;
      }
    });

    audio.addEventListener("ended", () => {
      nextBtn.click();
    });

    // Firebase Auth
    (function() {
      const signOutBtn = document.getElementById('signOutBtn');
      const userEmailSpan = document.getElementById('userEmail');

      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          userEmailSpan.textContent = user.email || user.displayName || '';
          userEmailSpan.classList.remove('d-none');
          signOutBtn.classList.remove('d-none');
        } else {
          window.location.href = "Login.html";
        }
      });

      signOutBtn.addEventListener('click', function() {
        firebase.auth().signOut().then(() => {
          window.location.href = "Login.html";
        }).catch((err) => {
          alert("Sign out error: " + err.message);
        });
      });
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
